<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>linux 常用命令 | Stan Xing 的个人博客</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="记录自己的技术成长">
    <link rel="preload" href="/blog/assets/css/0.styles.eb3efacf.css" as="style"><link rel="preload" href="/blog/assets/js/app.11df36d9.js" as="script"><link rel="preload" href="/blog/assets/js/2.371adafa.js" as="script"><link rel="preload" href="/blog/assets/js/9.c8d18b4a.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.76044a89.js"><link rel="prefetch" href="/blog/assets/js/11.16dcfdf2.js"><link rel="prefetch" href="/blog/assets/js/12.567cf3a1.js"><link rel="prefetch" href="/blog/assets/js/13.fc698a2f.js"><link rel="prefetch" href="/blog/assets/js/14.120e22bc.js"><link rel="prefetch" href="/blog/assets/js/15.31517948.js"><link rel="prefetch" href="/blog/assets/js/16.f2796001.js"><link rel="prefetch" href="/blog/assets/js/17.74fd029d.js"><link rel="prefetch" href="/blog/assets/js/18.ea9c27da.js"><link rel="prefetch" href="/blog/assets/js/19.c5d2f40c.js"><link rel="prefetch" href="/blog/assets/js/20.b55c339f.js"><link rel="prefetch" href="/blog/assets/js/21.95249f05.js"><link rel="prefetch" href="/blog/assets/js/22.488e1876.js"><link rel="prefetch" href="/blog/assets/js/23.ec1e14cd.js"><link rel="prefetch" href="/blog/assets/js/24.30acfa7a.js"><link rel="prefetch" href="/blog/assets/js/25.7e057639.js"><link rel="prefetch" href="/blog/assets/js/26.d6956725.js"><link rel="prefetch" href="/blog/assets/js/27.89ed39ae.js"><link rel="prefetch" href="/blog/assets/js/28.2eb00a11.js"><link rel="prefetch" href="/blog/assets/js/29.03f53804.js"><link rel="prefetch" href="/blog/assets/js/3.ce341c75.js"><link rel="prefetch" href="/blog/assets/js/30.94c936ff.js"><link rel="prefetch" href="/blog/assets/js/31.878fd6af.js"><link rel="prefetch" href="/blog/assets/js/32.12650543.js"><link rel="prefetch" href="/blog/assets/js/33.d88b3033.js"><link rel="prefetch" href="/blog/assets/js/34.8f4eb828.js"><link rel="prefetch" href="/blog/assets/js/35.6472fbc0.js"><link rel="prefetch" href="/blog/assets/js/36.76952610.js"><link rel="prefetch" href="/blog/assets/js/37.19d547c3.js"><link rel="prefetch" href="/blog/assets/js/38.89b3e172.js"><link rel="prefetch" href="/blog/assets/js/39.7110b5ad.js"><link rel="prefetch" href="/blog/assets/js/4.2c9d8f5c.js"><link rel="prefetch" href="/blog/assets/js/40.4c087bc2.js"><link rel="prefetch" href="/blog/assets/js/41.acd4d42c.js"><link rel="prefetch" href="/blog/assets/js/42.1eeecebb.js"><link rel="prefetch" href="/blog/assets/js/43.b8524b83.js"><link rel="prefetch" href="/blog/assets/js/44.78616964.js"><link rel="prefetch" href="/blog/assets/js/45.f0d78fa1.js"><link rel="prefetch" href="/blog/assets/js/46.780a79ed.js"><link rel="prefetch" href="/blog/assets/js/47.f5ee5c97.js"><link rel="prefetch" href="/blog/assets/js/48.f1cbe58a.js"><link rel="prefetch" href="/blog/assets/js/49.04dae616.js"><link rel="prefetch" href="/blog/assets/js/5.26b70a23.js"><link rel="prefetch" href="/blog/assets/js/50.4371b984.js"><link rel="prefetch" href="/blog/assets/js/51.bbe997be.js"><link rel="prefetch" href="/blog/assets/js/6.f8362109.js"><link rel="prefetch" href="/blog/assets/js/7.31bdba8f.js"><link rel="prefetch" href="/blog/assets/js/8.d84da6fa.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.eb3efacf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Stan Xing 的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/blog/" class="sidebar-link">前言</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Algorithms</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Kernel</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Ubuntu</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Systemd</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Shell</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/linux/shell/coding_style.html" class="sidebar-link">shell 编码规范</a></li><li><a href="/blog/linux/shell/grammer.html" class="sidebar-link">shell 常用语法</a></li><li><a href="/blog/linux/shell/command.html" class="active sidebar-link">linux 常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/linux/shell/command.html#awk" class="sidebar-link">AWK</a></li><li class="sidebar-sub-header"><a href="/blog/linux/shell/command.html#sed" class="sidebar-link">SED</a></li><li class="sidebar-sub-header"><a href="/blog/linux/shell/command.html#tcpdump" class="sidebar-link">tcpdump</a></li></ul></li><li><a href="/blog/linux/shell/zsh_vs_bash.html" class="sidebar-link">zsh 和 bash 的不同行为汇总</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NodeJS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Database</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Infrastructure</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SRE</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="linux-常用命令"><a href="#linux-常用命令" class="header-anchor">#</a> linux 常用命令</h1> <p>本文总结或收集了一些 linux 常用命令的具体用法介绍，供忘记的时候做个参考。</p> <h2 id="awk"><a href="#awk" class="header-anchor">#</a> AWK</h2> <ul><li><p><a href="https://github.com/mylxsw/growing-up/blob/master/doc/%E4%B8%89%E5%8D%81%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9AAWK.md" target="_blank" rel="noopener noreferrer">三十分钟学会AWK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>补充说明：</p> <ul><li><code>$0</code> 指的是一整行字符串，第一个字段是 <code>$1</code>。</li> <li><code>print</code> 的字符串拼接符是<code>空格</code>，所以如果想要打印空格，需要手动拼接 <code>&quot; &quot;</code>，同时一次 <code>print</code> 的结果会自带换行符。</li> <li>如果 awk 中指定了多个文件，<code>NR</code> 变量会把第二个文件的行号从第一个文件的行号末尾开始计数；而 <code>FNR</code> 变量会独立计算每个文件的行号，彼此不受影响。(在 ubuntu 16.04 下的测试结果)<br> <img src="/blog/assets/img/awk_1.d904de8c.png" alt="awk_NR_FNR"></li> <li>语句之间要加分号，例如：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 注意 if else 之间的分号，如果没有会报语法错误</span>
<span class="token function">awk</span> <span class="token string">'BEGIN{a=10; b = 20; if (a == b) print &quot;a == b&quot;; else print &quot;a != b&quot;}'</span>
a <span class="token operator">!=</span> b
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><p>awk 的字符串连接符是空格，不是加号：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">awk</span> <span class="token string">'BEGIN { str1 = &quot;Hello, &quot;; str2 = &quot;World&quot;; str3 = str1 str2; print str3 }'</span>
Hello, World
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>awk 的数组中如果没有定义某个下标的元素，则序号不会被打印：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>➜ <span class="token function">awk</span> <span class="token string">'BEGIN{arr[0]=1; arr[2]=10; for (i in arr) printf &quot;arr[%d]: %d<span class="token entity" title="\n">\n</span>&quot;, i, arr[i]}'</span>
arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>: <span class="token number">1</span>
arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: <span class="token number">10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>常见用例：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 统计第 3 列中每个值出现的次数</span>
<span class="token function">cat</span> files <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{a[<span class="token variable">$3</span>]++} END {for (i in a) {print i, a[i] | &quot;sort -k 2 -g -r&quot;}}'</span>
<span class="token comment"># 统计一个文件中的空白行</span>
<span class="token function">cat</span> files <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'/^$/{x++} END {print x}'</span>
<span class="token comment"># 查找替换</span>
<span class="token comment"># stanxing,1995.10.30 =&gt; tomxing,1995.10.30</span>
<span class="token function">cat</span> files <span class="token operator">|</span> <span class="token function">awk</span> -F <span class="token string">','</span> <span class="token string">'{gsub(/stan/,&quot;tom&quot;,<span class="token variable">$0</span>);print <span class="token variable">$0</span>}'</span>
<span class="token comment"># 计算每行数字的平均数</span>
<span class="token comment"># value,1,2,3,4,5 =&gt; value 3</span>
<span class="token function">cat</span> files <span class="token operator">|</span> <span class="token function">awk</span> -F <span class="token string">','</span> <span class="token string">'{total=<span class="token variable">$2</span>+<span class="token variable">$3</span>+<span class="token variable">$4</span>+<span class="token variable">$5</span>+<span class="token variable">$6</span>; avg=total/5}{print <span class="token variable">$1</span> &quot; &quot; total}'</span>
<span class="token comment"># 输出正则匹配的行</span>
<span class="token comment"># stanxing:pass</span>
<span class="token comment"># stanyang:rejected</span>
<span class="token function">cat</span> files <span class="token operator">|</span> <span class="token function">awk</span> -F <span class="token string">':'</span> <span class="token string">'<span class="token variable">$0</span> ~ /stanxing/'</span>
<span class="token comment"># if 的使用方式，如果第一个字段等于 stanxing 就输出</span>
<span class="token comment"># stanxing,1995.10.30</span>
<span class="token comment"># stanyang,1995.10.30</span>
<span class="token function">cat</span> files <span class="token operator">|</span> <span class="token function">awk</span> -F <span class="token string">','</span> <span class="token string">'{if (<span class="token variable">$1</span> == &quot;stanxing&quot;){print}}'</span>

<span class="token comment"># 根据下面的用例输出对应的用例结果</span>
<span class="token comment"># 输入：</span>
<span class="token comment"># 100</span>
<span class="token comment"># a 100</span>
<span class="token comment"># b -50</span>
<span class="token comment"># c -20</span>
<span class="token comment"># 输出：</span>
<span class="token comment"># 100</span>
<span class="token comment"># a 100</span>
<span class="token comment"># 200</span>
<span class="token comment"># b -50</span>
<span class="token comment"># 150</span>
<span class="token comment"># c -20</span>
<span class="token builtin class-name">echo</span> -e <span class="token string">&quot;100<span class="token entity" title="\n">\n</span>a 100<span class="token entity" title="\n">\n</span>b -50<span class="token entity" title="\n">\n</span>c -20&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{ if(NR==1) {sum=<span class="token variable">$1</span>; print <span class="token variable">$1</span>;} else if (NR == 4) {print <span class="token variable">$0</span>;} else {sum+=<span class="token variable">$2</span>; print <span class="token variable">$1</span>&quot; &quot;<span class="token variable">$2</span>&quot;<span class="token entity" title="\n">\n</span>&quot;sum;}}'</span>

<span class="token comment"># 根据输入用例输出对应的结果</span>
<span class="token comment">#输入：</span>
<span class="token comment"># 12334:13510014336</span>
<span class="token comment"># 12334:12343453453</span>
<span class="token comment"># 12099:13598989899</span>
<span class="token comment"># 12334:12345454545</span>
<span class="token comment"># 12099:12343454544</span>
<span class="token comment"># 输出：</span>
<span class="token comment"># [12334]</span>
<span class="token comment"># 13510014336</span>
<span class="token comment"># 12345454545</span>
<span class="token comment"># 12343453453</span>
<span class="token comment"># [12099]</span>
<span class="token comment"># 13598989899</span>
<span class="token comment"># 12343454544</span>
<span class="token builtin class-name">echo</span> -e <span class="token string">&quot;12334:13510014336<span class="token entity" title="\n">\n</span>12334:12343453453<span class="token entity" title="\n">\n</span>12099:13598989899<span class="token entity" title="\n">\n</span>12334:12345454545<span class="token entity" title="\n">\n</span>12099:12343454544&quot;</span> <span class="token operator">|</span> <span class="token function">sort</span> -r <span class="token operator">|</span> <span class="token punctuation">\</span>
    <span class="token function">awk</span> -F <span class="token string">':'</span> <span class="token string">'{a[<span class="token variable">$1</span>]++; if (a[<span class="token variable">$1</span>] == 1){print &quot;[&quot;<span class="token variable">$1</span>&quot;]&quot;; print <span class="token variable">$2</span>;} else {print <span class="token variable">$2</span>}}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div></li></ul></li></ul> <h2 id="sed"><a href="#sed" class="header-anchor">#</a> SED</h2> <ul><li><p><a href="https://github.com/mylxsw/growing-up/blob/master/doc/%E4%B8%89%E5%8D%81%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9ASED.md" target="_blank" rel="noopener noreferrer">三十分钟学会SED<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>补充说明：</p> <ul><li><p>使用 <code>-r</code> 开启扩展的正则表达式语法，可以使用 <code>\1</code> 代表匹配到正则分组的值</p></li> <li><p>在字符串替换命令 s 中使用 <code>\u 和 \U</code>的结果是不一样的，<code>\u</code> 只会作用一个字符，<code>\U</code> 会作用匹配到的所有字符：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">echo</span> -e <span class="token string">&quot;123abc456&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> -n -r <span class="token string">'s/[a-z]{3}/\u&amp;/p'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> 123Abc456
<span class="token builtin class-name">echo</span> -e <span class="token string">&quot;123abc456&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> -r <span class="token string">'s/[a-z]{3}/\U&amp;/p'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> 123ABC456
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>常见用例：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 将文本中的小写字母转换成大写</span>
<span class="token function">sed</span> <span class="token string">'s/[a-z]/\U&amp;/g'</span>
<span class="token comment"># 将文本中的大写字母转换成小写</span>
<span class="token function">sed</span> <span class="token string">'s/[A-Z]/\L&amp;/g'</span>
<span class="token comment"># 将 123abc456 变成 456ABC123</span>
<span class="token builtin class-name">echo</span> -e <span class="token string">&quot;123abc456&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> -r <span class="token string">'s#(...)(...)(...)#<span class="token entity" title="\3">\3</span>\U<span class="token entity" title="\2">\2</span><span class="token entity" title="\1">\1</span>#g'</span>
<span class="token comment"># 删除文件每行的第一个字符</span>
<span class="token function">sed</span> <span class="token string">'s/.//'</span>
<span class="token function">sed</span> -r <span class="token string">'s/(.)(.*)/<span class="token entity" title="\2">\2</span>/'</span>
<span class="token comment"># 删除文件每行的第二个字符</span>
<span class="token function">sed</span> -r <span class="token string">'s/(.)(.)(.*)/<span class="token entity" title="\1">\1</span><span class="token entity" title="\3">\3</span>/'</span>
<span class="token comment"># 删除文件每行的倒数第二个字符</span>
<span class="token function">sed</span> -r <span class="token string">'s/(.*)(.)(.)/<span class="token entity" title="\1">\1</span>/<span class="token entity" title="\3">\3</span>/'</span>
<span class="token comment"># 删除文件每行的第二个单词</span>
<span class="token function">sed</span> -r <span class="token string">'s/(\w+) (\w+) (\w+)/<span class="token entity" title="\1">\1</span> <span class="token entity" title="\3">\3</span>/'</span>
<span class="token comment"># 交换每行的第一个字符和第二个字符</span>
<span class="token function">sed</span> -r <span class="token string">'s/(.)(.)(.*)/<span class="token entity" title="\2">\2</span><span class="token entity" title="\1">\1</span><span class="token entity" title="\3">\3</span>/'</span>
<span class="token comment"># 删除一个文件中所有的数字</span>
<span class="token function">sed</span> <span class="token string">'s/[0-9]//g'</span>
<span class="token comment"># 删除每行开头的空格</span>
<span class="token function">sed</span> <span class="token string">'s/^\s+//'</span>
<span class="token comment"># 用制表符替换空格</span>
<span class="token function">sed</span> <span class="token string">'s/\s+/<span class="token entity" title="\t">\t</span>/g'</span>
<span class="token comment"># 把大写字母用括号括起来</span>
<span class="token function">sed</span> -r <span class="token string">'s/([A-z])/\(<span class="token entity" title="\1">\1</span>)/g'</span>
<span class="token comment"># 隔行删除</span>
<span class="token function">sed</span> <span class="token string">'0~2{=;d}'</span>
<span class="token comment"># 把文件第2行到4行的内容复制到第7行后面</span>
<span class="token function">sed</span> <span class="token string">'2h; 3,4H; 7G'</span>
<span class="token comment"># 把文件第2行到4行的内容移动到第7行后面</span>
<span class="token function">sed</span> <span class="token string">'2{h;d} 3,4{H;d}; 7G'</span>
<span class="token comment"># 去掉空行和以＃号开头的行</span>
<span class="token function">sed</span> -r <span class="token string">'/(^$|^#)/d'</span> 或者 <span class="token function">sed</span> -e <span class="token string">'/^$/d'</span> -e <span class="token string">'/^#/d'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div></li></ul></li></ul> <h2 id="tcpdump"><a href="#tcpdump" class="header-anchor">#</a> tcpdump</h2> <ul><li><p><a href="https://github.com/mylxsw/growing-up/blob/master/doc/tcpdump%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B.md" target="_blank" rel="noopener noreferrer">tcpdump 简明教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <ul><li>补充说明：</li></ul> <p>抓取 http 各请求方法的包，推荐使用 wireshark 的在线<a href="https://www.wireshark.org/tools/string-cf.html" target="_blank" rel="noopener noreferrer">Capture Filter Generator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。对各条件内容的解释写在了注释里。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 过滤 GET 请求，含义解释如下：</span>
<span class="token comment"># tcp[12:1] 的意思是获取第 13 个字节，实际该字节内存的是 TCP 首部长度，但首部长度只占 4 位；`0xf0` 转换成二进制就是 11110000，与 tcpp[12:1] 做与运算相当于只保留前 4 位的值（也就是首部长度）。</span>
<span class="token comment"># 然后对其做右移 2 位的运算，实际上应该右移 4 位才能将前 4 位从高位移动到低位，但是由于 TCP 首部 4 位最大值为 15，但是单位是 4 字节，所以最大可以表示 60 个字节，右移 4 位后还需要再乘以 4，相当于右移两位了。这样计算出了整个 TCP 头部的偏移，下面就是数据报的内容了。</span>
<span class="token comment"># 最后再一次通过 tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] 意味着越过 TCP 首部获取数据报的前 4 个字节，对于 http 请求来说，其请求头的样式为 `GET /ping HTTP 1.1`, 前四个字节就是 `GET `（注意最后是一个空格）。</span>
<span class="token comment"># tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420</span>

<span class="token comment"># 过滤 POST 请求，含义解释如下：</span>
<span class="token comment"># 整个含义是一样的，只不过 POST 请求的数据报要检查前五个字节，即 `POST `。但是 tcpdump 的语法字节偏移最大是 4，所以需要写两边。</span>
<span class="token comment"># tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x504f5354 &amp;&amp; tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2) + 4:1] = 0x20</span>

<span class="token comment"># 过滤 PUT 请求</span>
<span class="token comment"># tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x50555420</span>
<span class="token comment"># 过滤 DELETE 请求</span>
<span class="token comment"># tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x44454c45 &amp;&amp; tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2) + 4:2] = 0x5445 &amp;&amp; tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2) + 6:1] = 0x20</span>
<span class="token comment"># 过滤 HEAD 请求</span>
<span class="token comment"># tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x48454144 &amp;&amp; tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2) + 4:1] = 0x20</span>

<span class="token comment"># 过滤 HTTP 1.x 的响应，含义解释如下：</span>
<span class="token comment"># 原理也基本一样，只是 http 响应头的格式为 `HTTP/1.1 200 OK`，只需要过滤 `HTTP/1.`这几个字节（因为版本号不固定嘛）</span>
<span class="token comment"># tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x48545450 &amp;&amp; tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2) + 4:2] = 0x2f31 &amp;&amp; tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2) + 6:1] = 0x2e</span>

tcpdump -Avvvn <span class="token string">&quot;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420
        || (tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x504f5354 &amp;&amp; tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2) + 4:1] = 0x20)
        || (tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x50555420)
        || (tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x44454c45 &amp;&amp; tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2) + 4:2] = 0x5445 &amp;&amp; tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2) + 6:1] = 0x20)
        || (tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x48454144 &amp;&amp; tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2) + 4:1] = 0x20)
        || (tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x48545450 &amp;&amp; tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2) + 4:2] = 0x2f31 &amp;&amp; tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2) + 6:1] = 0x2e)&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/17/2020, 1:22:03 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/linux/shell/grammer.html" class="prev">
        shell 常用语法
      </a></span> <span class="next"><a href="/blog/linux/shell/zsh_vs_bash.html">
        zsh 和 bash 的不同行为汇总
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.11df36d9.js" defer></script><script src="/blog/assets/js/2.371adafa.js" defer></script><script src="/blog/assets/js/9.c8d18b4a.js" defer></script>
  </body>
</html>
