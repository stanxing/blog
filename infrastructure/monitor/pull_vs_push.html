<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pull Vs Push | Stan Xing 的个人博客</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="记录自己的技术成长">
    <link rel="preload" href="/blog/assets/css/0.styles.eb3efacf.css" as="style"><link rel="preload" href="/blog/assets/js/app.6d13759b.js" as="script"><link rel="preload" href="/blog/assets/js/2.371adafa.js" as="script"><link rel="preload" href="/blog/assets/js/39.5eeb7b08.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.76044a89.js"><link rel="prefetch" href="/blog/assets/js/11.16dcfdf2.js"><link rel="prefetch" href="/blog/assets/js/12.567cf3a1.js"><link rel="prefetch" href="/blog/assets/js/13.fc698a2f.js"><link rel="prefetch" href="/blog/assets/js/14.120e22bc.js"><link rel="prefetch" href="/blog/assets/js/15.31517948.js"><link rel="prefetch" href="/blog/assets/js/16.f2796001.js"><link rel="prefetch" href="/blog/assets/js/17.74fd029d.js"><link rel="prefetch" href="/blog/assets/js/18.ea9c27da.js"><link rel="prefetch" href="/blog/assets/js/19.c5d2f40c.js"><link rel="prefetch" href="/blog/assets/js/20.b55c339f.js"><link rel="prefetch" href="/blog/assets/js/21.95249f05.js"><link rel="prefetch" href="/blog/assets/js/22.488e1876.js"><link rel="prefetch" href="/blog/assets/js/23.62f3df12.js"><link rel="prefetch" href="/blog/assets/js/24.13398a36.js"><link rel="prefetch" href="/blog/assets/js/25.061fe821.js"><link rel="prefetch" href="/blog/assets/js/26.fa80b953.js"><link rel="prefetch" href="/blog/assets/js/27.79342037.js"><link rel="prefetch" href="/blog/assets/js/28.224192e2.js"><link rel="prefetch" href="/blog/assets/js/29.2713351c.js"><link rel="prefetch" href="/blog/assets/js/3.d2edf95a.js"><link rel="prefetch" href="/blog/assets/js/30.7b69fe57.js"><link rel="prefetch" href="/blog/assets/js/31.efcfe709.js"><link rel="prefetch" href="/blog/assets/js/32.7ff2ab7d.js"><link rel="prefetch" href="/blog/assets/js/33.0f3c446a.js"><link rel="prefetch" href="/blog/assets/js/34.4786b108.js"><link rel="prefetch" href="/blog/assets/js/35.3c498c3e.js"><link rel="prefetch" href="/blog/assets/js/36.bfbf82b4.js"><link rel="prefetch" href="/blog/assets/js/37.30b8f1ad.js"><link rel="prefetch" href="/blog/assets/js/38.1148a674.js"><link rel="prefetch" href="/blog/assets/js/4.2c9d8f5c.js"><link rel="prefetch" href="/blog/assets/js/40.d6375d92.js"><link rel="prefetch" href="/blog/assets/js/41.002bc860.js"><link rel="prefetch" href="/blog/assets/js/42.1461c1b7.js"><link rel="prefetch" href="/blog/assets/js/43.b0f5584f.js"><link rel="prefetch" href="/blog/assets/js/44.1a945646.js"><link rel="prefetch" href="/blog/assets/js/45.f23f8f18.js"><link rel="prefetch" href="/blog/assets/js/46.780a79ed.js"><link rel="prefetch" href="/blog/assets/js/47.f5ee5c97.js"><link rel="prefetch" href="/blog/assets/js/48.f1cbe58a.js"><link rel="prefetch" href="/blog/assets/js/49.04dae616.js"><link rel="prefetch" href="/blog/assets/js/5.26b70a23.js"><link rel="prefetch" href="/blog/assets/js/50.4371b984.js"><link rel="prefetch" href="/blog/assets/js/51.bbe997be.js"><link rel="prefetch" href="/blog/assets/js/6.dc656f0b.js"><link rel="prefetch" href="/blog/assets/js/7.bda6ec64.js"><link rel="prefetch" href="/blog/assets/js/8.cf18d63f.js"><link rel="prefetch" href="/blog/assets/js/9.cc1fc44e.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.eb3efacf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Stan Xing 的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/blog/" class="sidebar-link">前言</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Algorithms</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NodeJS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Database</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Infrastructure</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SRE</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pull-vs-push"><a href="#pull-vs-push" class="header-anchor">#</a> Pull Vs Push</h1> <p>在考虑如何将 metrics 存入监控系统中时，一般有两种不同的解决方案。即 pull 和 push。pull 是指由监控系统从应用程序中拉取数据，这种情况一般需要应用程序监听一个端口暴露 metrics（使用 http）； push 是指由应用程序将 metrics 推送到系统中，一般使用 UDP。</p> <p>push 方式的代表有 Graphite、influxdb；push 方式的代表就是 prometheus。两种方式都有各自的优缺点和适用的场景，下面将分析两种模式的优缺点。</p> <h2 id="支持-pull-的理由"><a href="#支持-pull-的理由" class="header-anchor">#</a> 支持 Pull 的理由</h2> <ul><li><p>更容易控制数据的真实性和数量：因为对哪些服务拉取 metrics 是由监控系统来配置并发起连接的，而在基于 push 的模型来说，只能靠白名单来决定允许哪些服务来推送数据，并不是所有的系统都支持白名单，而且推送的频率也是由应用程序决定的，服务端只能被动接收，如果推送数据太多，可能对监控系统造成负担。</p></li> <li><p>更轻松的检索数据和 debug：pull 的模型很容易的看到应用程序返回的数据，像 porometheus 格式，每行数据都有注释来表达 metric 的意义。而且容易 debug，如果 push 模型没有收到数据，那有两种情况：应用程序发送的错误；监控系统接收的错误。pull 模型就很好判断了，在浏览器里面访问以下 metric 对应的 url 看看有没有数据返回。</p></li> <li><p>更容易对数据加密：基于 https 协议的 pull 模型只需要在应用程序配置了证书即可。对于基于 udp 的 push 模型，就需要应用程序级别先对数据加密，然后发送给监控系统，监控系统再解密这样子，显然变得更复杂了。</p></li></ul> <h2 id="支持-push-的理由"><a href="#支持-push-的理由" class="header-anchor">#</a> 支持 Push 的理由</h2> <ul><li><p>更容易实现摄取多副本的 metrics：现代应用大部分是基于分布式的，有多个副本，多个副本还支持自动扩容缩容，对于 pul 的模型来说，其维护的服务实例 ip 列表是一个动态变化的数组，所以就需要监控系统实现一个服务发现的组件来动态维护后端 ip 列表。而对于 push 模型来说，只要客户端推送即可，跟客户端数量无关，执行的是相同的代码逻辑。</p></li> <li><p>适用于短生命周期的 batch job：对于 pull 模型来说，是周期性的提供 metrics 供监控程序拉取，而一般来说 batch job 的生命周期较短，可能没来的及启动一个 server，业务逻辑就执行完了，这样里面的监控数据没来的及被抓取就结束了，这类情况应该使用 push 模型。</p></li> <li><p>push 一般使用 udp，pull 使用 http，从性能的角度分析 udp 不用维护连接，性能会更好一些。</p></li></ul> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://giedrius.blog/2019/05/11/push-vs-pull-in-monitoring-systems/" target="_blank" rel="noopener noreferrer">push-vs-pull-in-monitoring-systems<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/12/2020, 2:19:47 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.6d13759b.js" defer></script><script src="/blog/assets/js/2.371adafa.js" defer></script><script src="/blog/assets/js/39.5eeb7b08.js" defer></script>
  </body>
</html>
