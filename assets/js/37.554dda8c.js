(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{220:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"journalbeat-性能测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#journalbeat-性能测试"}},[s._v("#")]),s._v(" journalbeat 性能测试")]),s._v(" "),a("h2",{attrs:{id:"测试准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试准备"}},[s._v("#")]),s._v(" 测试准备")]),s._v(" "),a("ul",[a("li",[s._v("logs-mocker 服务，快速产生日志并由 docker driver 写入到 journald，产生的日志基本是没有差别的，单条日志大小在 1132 字节左右。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 详情参考 logs-mocker 文件夹")]),s._v("\ndocker run -d --env "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TOTAL=2000000"')]),s._v(" nodejs-logs-mocker:latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("outputAccessLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" access "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('{\n        "type" : "access",\n        "method" : "GET",\n        "url" : "/mocker",\n        "remoteAddr" : "127.0.0.1",\n        "responseStatus" : 200,\n        "responseTime" : 0.01,\n        "upstreamResponseTime" : 0.01,\n        "timeUnit" : "s",\n        "referr" : "http//referrr",\n        "userAgent" : "agent",\n        "body": "1",\n        "responseBodySize" : ')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(',\n        "reqId": "reqId"\n    }')]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    str "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[s._v("/\\ +/g")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    str "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[s._v("/[ ]/g")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[s._v("/[\\r\\n]/g")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" total "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TOTAL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" startTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("outputAccessLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" endTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'time: '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" startTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" endTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'interval:'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" endTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" startTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ms'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'count:'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br")])]),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://github.com/mheese/journalbeat",target:"_blank",rel:"noopener noreferrer"}},[s._v("journalbeat"),a("OutboundLink")],1),s._v("，读取 journald 的日志并输出到后端 （文件，console等），后续称其为 journalbeat-mheese。")])]),s._v(" "),a("li",[a("p",[a("s",[s._v("elastic 官方 "),a("a",{attrs:{href:"https://github.com/elastic/beats/blob/master/journalbeat",target:"_blank",rel:"noopener noreferrer"}},[s._v("journalbeat"),a("OutboundLink")],1),s._v("，因此把它也作为一个备选方案，测试下性能，后续称其为 journalbeat-elastic。")]),s._v(", 由于发现了 "),a("a",{attrs:{href:"https://github.com/elastic/beats/issues/9533",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/elastic/beats/issues/9533"),a("OutboundLink")],1),s._v(" 这个bug，在 linux systemd 版本 < 233 的机器上，当 journald rotate 日志后会停止收集，暂时不测试了。")])])]),s._v(" "),a("h3",{attrs:{id:"测试机器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试机器"}},[s._v("#")]),s._v(" 测试机器")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("本机：4Core 8G, Intel(R) Core(TM) i5-4590 CPU @ 3.30GHz")])]),s._v(" "),a("li",[a("p",[s._v("阿里云ECS：8Core 32G, Intel(R) Xeon(R) Platinum 8163 CPU @ 2.50GHz")])])]),s._v(" "),a("h4",{attrs:{id:"场景1-（单独测试-journald-的写入速度）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景1-（单独测试-journald-的写入速度）"}},[s._v("#")]),s._v(" 场景1 （单独测试 journald 的写入速度）")]),s._v(" "),a("p",[s._v("journald 的写入速度没有监控的 metrics，但通过几轮测试发现，基本上标准输出结束的时间跟 journald 写入完成的时间的相同的（依据来源于观察到当 docker 容器的标准输出日志打印完成后，journald 的 cpu 使用率也刚好为0）。所以，测试方法为 "),a("code",[s._v("docker inspect ${containerId}")]),s._v(" 去查看容器启动和终止的时间差。")]),s._v(" "),a("p",[s._v("本机结果：")]),s._v(" "),a("ul",[a("li",[s._v("向 journald 写入 100w 条日志，时间花费 60 秒, cpu 稳定在 90% - 99%，写入速度在 16666 条 /s。")]),s._v(" "),a("li",[s._v("向 journald 写入 200w 条日志，时间花费 129 秒, cpu 稳定在 90% - 99%，写入速度在 15503 条 /s。")])]),s._v(" "),a("p",[s._v("从时间来看，journald 的写入速度还是比较稳定的。")]),s._v(" "),a("p",[s._v("阿里云结果：")]),s._v(" "),a("ul",[a("li",[s._v("向 journald 写入 100w 条日志，时间花费 100秒, cpu 稳定在 90% - 99%, 写入速度在 10000 条 /s。")]),s._v(" "),a("li",[s._v("向 journald 写入 200w 条日志，时间花费 210 秒, cpu 稳定在 90% - 99%, 写入速度在 9523 条 /s。")])]),s._v(" "),a("p",[s._v("在写入过程中，journald 的 cpu 一直是 90%-99%，基本上达到极限了（systemd-journald 服务应该是 cpu 最大使用一个核，测试这么久没发现超过 100% 的）。写入速度在 10000 条/s。相比本机有差距的原因应该是单核的性能问题，本机的主频更大一些。")]),s._v(" "),a("h4",{attrs:{id:"场景2（单独测试-journalbeat-的读取速度）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景2（单独测试-journalbeat-的读取速度）"}},[s._v("#")]),s._v(" 场景2（单独测试 journalbeat 的读取速度）")]),s._v(" "),a("p",[s._v("logs-mocker 先写 200w 日志，待写入到 journald 之后，再启动 journalbeat 去收集。")]),s._v(" "),a("p",[s._v("本机结果：")]),s._v(" "),a("ul",[a("li",[s._v("journalbeat cpu 稳定在 190% - 207%， 30s 输出 41w 条 events, 13666 条/s，14.8MB/s; 同时 systemd-journald 的 cpu 基本稳定在 0%。(从 journald 读取日志不耗 cpu？)")])]),s._v(" "),a("p",[s._v("阿里云结果：")]),s._v(" "),a("ul",[a("li",[s._v("journalbeat cpu 稳定在 260% - 270%， 30s 输出 49w 条，16333 条/s，17.6MB/s；同时 systemd-journald 的 cpu 基本稳定在 0%。")])]),s._v(" "),a("p",[s._v("journalbeat 可以用到接近 3个核心。不限 cpu 的情况下，多核心还是有优势的。")]),s._v(" "),a("h4",{attrs:{id:"场景3（测试同时读写）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景3（测试同时读写）"}},[s._v("#")]),s._v(" 场景3（测试同时读写）")]),s._v(" "),a("p",[s._v("logs-mocker 写 200w 日志，同时 journalbeat 读日志。")]),s._v(" "),a("p",[s._v("本机结果：")]),s._v(" "),a("ul",[a("li",[s._v("journalbeat cpu 稳定在 140% - 155%， 30s 输出 32w 条, 10666 条/s，9.7MB/s; 同时 systemd-journald 的 cpu 基本稳定在 90%-99%。")]),s._v(" "),a("li",[s._v("容器一共运行了 138 秒。大致算出 journald 写入速度为 14492 条 /s。")])]),s._v(" "),a("p",[s._v("阿里云结果：")]),s._v(" "),a("ul",[a("li",[s._v("journalbeat cpu 稳定在 165% - 185%， 30s 输出 29w 条, 9600 条/s，单条日志 1132 字节，9.7MB/s; 同时 systemd-journald 的 cpu 基本稳定在 97-99%。")]),s._v(" "),a("li",[s._v("容器一共运行了 227 秒。大致算出 journald 写入速度为 8810 条 /s。")])]),s._v(" "),a("h4",{attrs:{id:"场景4（测试写入到-console-的速度）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景4（测试写入到-console-的速度）"}},[s._v("#")]),s._v(" 场景4（测试写入到 console 的速度）")]),s._v(" "),a("p",[s._v("本机结果：")]),s._v(" "),a("ul",[a("li",[s._v("边读边写时，journalbeat cpu 稳定在 110% - 120%， 30s 输出 18w 条 events, 6000 条/s，同时 systemd-journald 的 cpu 基本稳定在 40%-50%，cpu 没有使用很多，应该是IO慢导致的，（按理说写到标准输出应该更快才对，毕竟相当与写入内存？）")]),s._v(" "),a("li",[s._v("先写再读时，journalbeat cpu 稳定在 160% - 170%， 30s 输出 30w 条 events, 10000 条/s，同时 systemd-journald 的 cpu 基本稳定在 0%。")])]),s._v(" "),a("p",[s._v("两种测试看起来写入 console 的速度相对而言都不理想。")])])}),[],!1,null,null,null);t.default=e.exports}}]);